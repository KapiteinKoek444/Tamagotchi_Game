ül
kC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Shop\Controllers\ActiveMqController.cs
	namespace 	
Tamago_Shop
 
. 
Controllers !
{ 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
ActiveMQController  
:! "

Controller# -
{ 
private 	
IMongoCollection
 
< 
	FoodModel $
>$ %
_foodCollection& 5
;5 6
private 	
readonly
 
IActiveMqLog 
_activeMQLogBank  0
;0 1
private 	
readonly
 
IActiveMqLog 
_activeMQLogInv  /
;/ 0
private 	
readonly
 
IActiveMqLog  
_activeMQLogInvItems  4
;4 5
private 	
bool
 
added 
= 
false 
; 
public 
ActiveMQController	 
( 
IMongoClient (
client) /
,/ 0
IActiveMqLog1 =
activeMQLog> I
)I J
{ 
var 
database 
= 
client 
. 
GetDatabase $
($ %
$str% 4
)4 5
;5 6
_foodCollection 
= 
database 
. 
GetCollection +
<+ ,
	FoodModel, 5
>5 6
(6 7
$str7 >
)> ?
;? @
_activeMQLogBank 
= 
activeMQLog !
;! "
_activeMQLogInv   
=   
activeMQLog    
;    ! 
_activeMQLogInvItems!! 
=!! 
activeMQLog!! %
;!!% &
ListenToMessage## 
(## 
)## 
;## 
}$$ 
[&& #
ExcludeFromCodeCoverage&& 
]&& 
private'' 	
async''
 
void'' 
ListenToMessage'' $
(''$ %
)''% &
{(( 
_activeMQLogBank** 
.** 
ConnectListener** #
(**# $
$str**$ @
)**@ A
;**A B
var++ 
bankListener++ 
=++ 
_activeMQLogBank++ &
.++& '
GetMessageConsumer++' 9
(++9 :
)++: ;
;++; <
bankListener,, 
.,, 
Listener,, 
+=,, 
new,, 
MessageListener,,  /
(,,/ 0
UponBankMessage,,0 ?
),,? @
;,,@ A
_activeMQLogInv.. 
... 
ConnectListener.. "
(.." #
$str..# :
)..: ;
;..; <
var// 
invListener// 
=// 
_activeMQLogInv// $
.//$ %
GetMessageConsumer//% 7
(//7 8
)//8 9
;//9 :
invListener00 
.00 
Listener00 
+=00 
new00 
MessageListener00 .
(00. /
UponInvMessage00/ =
)00= >
;00> ? 
_activeMQLogInvItems22 
.22 
ConnectListener22 '
(22' (
$str22( <
)22< =
;22= >
var33 
invGetListeneer33 
=33  
_activeMQLogInvItems33 -
.33- .
GetMessageConsumer33. @
(33@ A
)33A B
;33B C
invGetListeneer44 
.44 
Listener44 
+=44 
new44 "
MessageListener44# 2
(442 3
UponInvGetMessage443 D
)44D E
;44E F
}55 
[77 
HttpPost77 
]77 
[88 
Route88 
(88 	
$str88	 
)88 
]88 
public99 
async99	 
Task99 
<99 
string99 
>99 
BuyFood99 #
(99# $
[99$ %
FromBody99% -
]99- .
BuyItemModel99/ ;
model99< A
)99A B
{:: 
var;; 
filter;; 
=;; 
Builders;; 
<;; 
	FoodModel;; "
>;;" #
.;;# $
Filter;;$ *
.;;* +
Eq;;+ -
(;;- .
$str;;. 2
,;;2 3
model;;4 9
.;;9 :
itemId;;: @
);;@ A
;;;A B
var<< 
data<< 
=<< 
_foodCollection<< 
.<< 
Find<< "
(<<" #
filter<<# )
)<<) *
.<<* +
First<<+ 0
(<<0 1
)<<1 2
;<<2 3
Task?? 
<?? 
string?? 
>?? 
reply?? 
=?? 
AddFoodToInventory?? *
(??* +
data??+ /
,??/ 0
model??1 6
.??6 7
userId??7 =
)??= >
;??> ?
var@@ 
r@@ 
=@@	 

reply@@ 
.@@ 
ToString@@ 
(@@ 
)@@ 
;@@ 
returnAA 	
rAA
 
;AA 
}BB 
[DD #
ExcludeFromCodeCoverageDD 
]DD 
privateEE 	
asyncEE
 
TaskEE 
<EE 
stringEE 
>EE 
AddFoodToInventoryEE /
(EE/ 0
	FoodModelEE0 9
foodEE: >
,EE> ?
GuidEE@ D
userIdEEE K
)EEK L
{FF 
	ItemModelGG 
modelGG 
=GG 
newGG 
	ItemModelGG "
(GG" #
)GG# $
;GG$ %
modelHH 
.HH 	
itemIdHH	 
=HH 
foodHH 
.HH 
idHH 
;HH 
modelII 
.II 	
priceII	 
=II 
foodII 
.II 
priceII 
-II 
foodII "
.II" #
discountII# +
;II+ ,
modelJJ 
.JJ 	
userIdJJ	 
=JJ 
userIdJJ 
;JJ 
_activeMQLogBankLL 
.LL 
ConnectSenderLL !
(LL! "
$strLL" 6
)LL6 7
;LL7 8
varMM 
producerMM 
=MM 
_activeMQLogBankMM "
.MM" #
GetMessageProducerMM# 5
(MM5 6
)MM6 7
;MM7 8
varNN 
messageNN 
=NN 
_activeMQLogBankNN !
.NN! "#
ConvertObjectToIMessageNN" 9
<NN9 :
	ItemModelNN: C
>NNC D
(NND E
modelNNE J
)NNJ K
;NNK L
producerOO 
.OO 
SendOO 
(OO 
messageOO 
)OO 
;OO 
whileQQ 
(QQ	 

addedQQ
 
==QQ 
falseQQ 
)QQ 
{RR 
awaitSS 	
TaskSS
 
.SS 
DelaySS 
(SS 
$numSS 
)SS 
;SS 
}TT 
returnVV 	
$strVV
 
;VV 
}WW 
[YY #
ExcludeFromCodeCoverageYY 
]YY 
privateZZ 	
asyncZZ
 
voidZZ 
UponBankMessageZZ $
(ZZ$ %
IMessageZZ% -
messageZZ. 5
)ZZ5 6
{[[ 
ITextMessage\\ 
objectMessage\\ 
=\\ 
message\\  '
as\\( *
ITextMessage\\+ 7
;\\7 8
	ItemModel]] 
received]] 
=]] 
_activeMQLogBank]] (
.]]( )#
ConvertIMessageToObject]]) @
<]]@ A
	ItemModel]]A J
>]]J K
(]]K L
objectMessage]]L Y
)]]Y Z
;]]Z [
if__ 
(__ 
received__ 
.__ 
confirmation__ 
)__ 
{`` 
_activeMQLogBankaa 
.aa 
ConnectSenderaa "
(aa" #
$straa# =
)aa= >
;aa> ?
varbb 
producerbb 
=bb 
_activeMQLogBankbb #
.bb# $
GetMessageProducerbb$ 6
(bb6 7
)bb7 8
;bb8 9
producercc 
.cc 
Sendcc 
(cc 
messagecc 
)cc 
;cc 
}dd 
}ee 
[gg #
ExcludeFromCodeCoveragegg 
]gg 
privatehh 	
asynchh
 
voidhh 
UponInvMessagehh #
(hh# $
IMessagehh$ ,
messagehh- 4
)hh4 5
{ii 
ITextMessagejj 
objectMessagejj 
=jj 
messagejj  '
asjj( *
ITextMessagejj+ 7
;jj7 8
	ItemModelkk 
receivedkk 
=kk 
_activeMQLogInvkk '
.kk' (#
ConvertIMessageToObjectkk( ?
<kk? @
	ItemModelkk@ I
>kkI J
(kkJ K
objectMessagekkK X
)kkX Y
;kkY Z
ifmm 
(mm 
receivedmm 
.mm 
confirmationmm 
)mm 
addednn 	
=nn
 
truenn 
;nn 
}oo 
[qq #
ExcludeFromCodeCoverageqq 
]qq 
privaterr 	
asyncrr
 
voidrr 
UponInvGetMessagerr &
(rr& '
IMessagerr' /
messagerr0 7
)rr7 8
{ss  
_activeMQLogInvItemstt 
.tt 
ConnectSendertt %
(tt% &
$strtt& =
)tt= >
;tt> ?
varuu 
produceruu 
=uu  
_activeMQLogInvItemsuu &
.uu& '
GetMessageProduceruu' 9
(uu9 :
)uu: ;
;uu; <
ITextMessageww 
objectMessageww 
=ww 
messageww  '
asww( *
ITextMessageww+ 7
;ww7 8
RequestItemModelxx 
modelxx 
=xx  
_activeMQLogInvItemsxx 0
.xx0 1#
ConvertIMessageToObjectxx1 H
<xxH I
RequestItemModelxxI Y
>xxY Z
(xxZ [
objectMessagexx[ h
)xxh i
;xxi j$
RequestItemResponseModelyy 
responseyy $
=yy% &
newyy' *$
RequestItemResponseModelyy+ C
(yyC D
)yyD E
;yyE F
response{{ 
.{{ 
userId{{ 
={{ 
model{{ 
.{{ 
userId{{ !
;{{! "
response|| 
.|| 
items|| 
=|| 
new|| 
List|| 
<|| 
	FoodModel|| &
>||& '
(||' (
)||( )
;||) *
foreach~~ 

(~~
 
var~~ 
i~~ 
in~~ 
model~~ 
.~~ 
Items~~ 
)~~  
{ 
var
ÄÄ 
filter
ÄÄ 
=
ÄÄ 
Builders
ÄÄ 
<
ÄÄ 
	FoodModel
ÄÄ #
>
ÄÄ# $
.
ÄÄ$ %
Filter
ÄÄ% +
.
ÄÄ+ ,
Eq
ÄÄ, .
(
ÄÄ. /
$str
ÄÄ/ 3
,
ÄÄ3 4
i
ÄÄ5 6
)
ÄÄ6 7
;
ÄÄ7 8
var
ÅÅ 
data
ÅÅ 
=
ÅÅ 
_foodCollection
ÅÅ 
.
ÅÅ 
Find
ÅÅ #
(
ÅÅ# $
filter
ÅÅ$ *
)
ÅÅ* +
.
ÅÅ+ ,
First
ÅÅ, 1
(
ÅÅ1 2
)
ÅÅ2 3
;
ÅÅ3 4
	FoodModel
ÇÇ 
m
ÇÇ 
=
ÇÇ 
new
ÇÇ 
	FoodModel
ÇÇ 
(
ÇÇ  
)
ÇÇ  !
;
ÇÇ! "
m
ÑÑ 
.
ÑÑ 
id
ÑÑ 
=
ÑÑ	 

data
ÑÑ 
.
ÑÑ 
id
ÑÑ 
;
ÑÑ 
m
ÖÖ 
.
ÖÖ 
name
ÖÖ 

=
ÖÖ 
data
ÖÖ 
.
ÖÖ 
name
ÖÖ 
;
ÖÖ 
m
ÜÜ 
.
ÜÜ 
category
ÜÜ 
=
ÜÜ 
data
ÜÜ 
.
ÜÜ 
category
ÜÜ 
;
ÜÜ 
m
áá 
.
áá 
price
áá 
=
áá 
data
áá 
.
áá 
price
áá 
;
áá 
m
àà 
.
àà 
discount
àà 
=
àà 
data
àà 
.
àà 
discount
àà 
;
àà 
m
ââ 
.
ââ 
foodVal
ââ 
=
ââ 
data
ââ 
.
ââ 
foodVal
ââ 
;
ââ 
m
ää 
.
ää 
	energyVal
ää 
=
ää 
data
ää 
.
ää 
	energyVal
ää  
;
ää  !
m
ãã 
.
ãã 
happyVal
ãã 
=
ãã 
data
ãã 
.
ãã 
happyVal
ãã 
;
ãã 
response
çç 
.
çç 
items
çç 
.
çç 
Add
çç 
(
çç 
m
çç 
)
çç 
;
çç 
}
éé 
var
êê 

newMessage
êê 
=
êê "
_activeMQLogInvItems
êê (
.
êê( )%
ConvertObjectToIMessage
êê) @
(
êê@ A
response
êêA I
)
êêI J
;
êêJ K
producer
íí 
.
íí 
Send
íí 
(
íí 

newMessage
íí 
)
íí 
;
íí 
}
ìì 
[
ïï 
HttpGet
ïï 

]
ïï
 
public
ññ 
async
ññ	 
Task
ññ 
<
ññ 
string
ññ 
>
ññ 
Get
ññ 
(
ññ  
)
ññ  !
{
óó 
return
òò 	
$str
òò
 &
;
òò& '
}
ôô 
}
öö 
}õõ è.
gC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Shop\Controllers\RestController.cs
	namespace		 	
Tamago_Shop		
 
.		 
Controllers		 !
{

 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
RestController 
: 

Controller )
{ 
private 	
IMongoCollection
 
< 
	FoodModel $
>$ %
_foodCollection& 5
;5 6
public 
RestController	 
( 
IMongoClient $
client% +
)+ ,
{ 
var 
database 
= 
client 
. 
GetDatabase $
($ %
$str% 4
)4 5
;5 6
_foodCollection 
= 
database 
. 
GetCollection +
<+ ,
	FoodModel, 5
>5 6
(6 7
$str7 >
)> ?
;? @
} 
public 
IActionResult	 
Index 
( 
) 
{ 
return 	
View
 
( 
) 
; 
} 
[ 
HttpGet 

]
 
public 
IEnumerable	 
< 
	FoodModel 
> 
Get  #
(# $
)$ %
{ 
var 
data 
= 
_foodCollection 
. 
Find "
(" #
Builders# +
<+ ,
	FoodModel, 5
>5 6
.6 7
Filter7 =
.= >
Empty> C
)C D
.D E
ToListE K
(K L
)L M
;M N
return   	
data  
 
;   
}!! 
[## 
HttpGet## 

(##
 
$str## 
)## 
]## 
public$$ 
	FoodModel$$	 
Get$$ 
($$ 
[$$ 
	FromRoute$$ !
]$$! "
Guid$$# '
id$$( *
)$$* +
{%% 
var&& 
filter&& 
=&& 
Builders&& 
<&& 
	FoodModel&& "
>&&" #
.&&# $
Filter&&$ *
.&&* +
Eq&&+ -
(&&- .
$str&&. 2
,&&2 3
id&&4 6
)&&6 7
;&&7 8
var'' 
data'' 
='' 
_foodCollection'' 
.'' 
Find'' "
(''" #
filter''# )
)'') *
.''* +
FirstOrDefault''+ 9
(''9 :
)'': ;
;''; <
return(( 	
data((
 
;(( 
})) 
[++ 

HttpDelete++ 
(++ 
$str++ 
)++ 
]++ 
[,, 
Route,, 
(,, 	
$str,,	 
),, 
],, 
public-- 
	FoodModel--	 
Remove-- 
(-- 
[-- 
	FromRoute-- $
]--$ %
Guid--& *
id--+ -
)--- .
{.. 
var// 
filter// 
=// 
Builders// 
<// 
	FoodModel// "
>//" #
.//# $
Filter//$ *
.//* +
Eq//+ -
(//- .
$str//. 2
,//2 3
id//4 6
)//6 7
;//7 8
var00 
data00 
=00 
_foodCollection00 
.00 
FindOneAndDelete00 .
(00. /
filter00/ 5
)005 6
;006 7
return11 	
data11
 
;11 
}22 
[44 
HttpPost44 
]44 
[55 
Route55 
(55 	
$str55	 
)55 
]55 
public66 
IActionResult66	 
Post66 
(66 
[66 
FromBody66 %
]66% &
	FoodModel66' 0
food661 5
)665 6
{77 
_foodCollection88 
.88 
	InsertOne88 
(88 
food88 !
)88! "
;88" #
return99 	

StatusCode99
 
(99 
StatusCodes99  
.99  !
Status201Created99! 1
,991 2
food993 7
)997 8
;998 9
}:: 
[<< 
Route<< 
(<< 	
$str<<	 
)<< 
]<< 
public== 
void==	 
PushFood== 
(== 
)== 
{>> 
	FoodModel?? 
food?? 
=?? 
new?? 
	FoodModel?? !
(??! "
)??" #
;??# $
food@@ 
.@@ 
id@@ 

=@@ 
Guid@@ 
.@@ 
NewGuid@@ 
(@@ 
)@@ 
;@@ 
foodAA 
.AA 
nameAA 
=AA 
$strAA 
;AA 
foodBB 
.BB 
categoryBB 
=BB 
$strBB 
;BB 
foodCC 
.CC 
priceCC 
=CC 
$numCC 
;CC 
foodDD 
.DD 
discountDD 
=DD 
$numDD 
;DD 
foodFF 
.FF 
foodValFF 
=FF 
$numFF 
;FF 
foodGG 
.GG 
	energyValGG 
=GG 
$numGG 
;GG 
foodHH 
.HH 
happyValHH 
=HH 
$numHH 
;HH 
PostJJ 
(JJ 
foodJJ 
)JJ 
;JJ 
}KK 
}LL 
}MM 

TC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Shop\Program.cs
	namespace 	
Tamago_Shop
 
{ 
[ #
ExcludeFromCodeCoverage 
] 
public 
class 
Program 
{ 
public 
static	 
void 
Main 
( 
string  
[  !
]! "
args# '
)' (
{ 
CreateHostBuilder 
( 
args 
) 
. 
Build  
(  !
)! "
." #
Run# &
(& '
)' (
;( )
} 
public 
static	 
IHostBuilder 
CreateHostBuilder .
(. /
string/ 5
[5 6
]6 7
args8 <
)< =
=>> @
Host 
.  
CreateDefaultBuilder 
( 
args !
)! "
. $
ConfigureWebHostDefaults 
( 

webBuilder (
=>) +
{ 

webBuilder 
. 

UseStartup 
< 
Startup "
>" #
(# $
)$ %
;% &
} 
) 
; 
} 
} å 
TC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Shop\Startup.cs
	namespace 	
Tamago_Shop
 
{ 
[ #
ExcludeFromCodeCoverage 
] 
public 
class 
Startup 
{ 
public 
Startup	 
( 
IConfiguration 
configuration  -
)- .
{ 
Configuration 
= 
configuration  
;  !
} 
public 
IConfiguration	 
Configuration %
{& '
get( +
;+ ,
}- .
public 
void	 
ConfigureServices 
(  
IServiceCollection  2
services3 ;
); <
{ 
services   
.   
AddSingleton   
<   
IMongoClient   %
,  % &
MongoClient  ' 2
>  2 3
(  3 4
s  4 5
=>  6 8
{!! 
var"" 
uri"" 
="" 
s"" 
."" 
GetRequiredService"" "
<""" #
IConfiguration""# 1
>""1 2
(""2 3
)""3 4
[""4 5
$str""5 ?
]""? @
;""@ A
return## 

new## 
MongoClient## 
(## 
uri## 
)## 
;##  
}$$ 
)$$ 
;$$ 
services&& 
.&& 
AddSingleton&& 
<&& 
IActiveMqLog&& %
,&&% &
ActiveMQLog&&' 2
>&&2 3
(&&3 4
s&&4 5
=>&&6 8
{'' 
var(( 
uri(( 
=(( 
s(( 
.(( 
GetRequiredService(( "
<((" #
IConfiguration((# 1
>((1 2
(((2 3
)((3 4
[((4 5
$str((5 <
]((< =
;((= >
var)) 
username)) 
=)) 
s)) 
.)) 
GetRequiredService)) '
<))' (
IConfiguration))( 6
>))6 7
())7 8
)))8 9
[))9 :
$str)): F
]))F G
;))G H
var** 
password** 
=** 
s** 
.** 
GetRequiredService** '
<**' (
IConfiguration**( 6
>**6 7
(**7 8
)**8 9
[**9 :
$str**: F
]**F G
;**G H
ActiveMQLog-- 
result-- 
=-- 
new-- 
ActiveMQLog-- (
(--( )
uri--) ,
,--, -
username--. 6
,--6 7
password--8 @
)--@ A
;--A B
return.. 

result.. 
;.. 
}// 
)// 
;// 
services11 
.11 
AddControllers11 
(11 
)11 
;11 
}22 
public55 
void55	 
	Configure55 
(55 
IApplicationBuilder55 +
app55, /
,55/ 0
IWebHostEnvironment551 D
env55E H
)55H I
{66 
if77 
(77 
env77 

.77
 
IsDevelopment77 
(77 
)77 
)77 
{88 
app99 
.99 %
UseDeveloperExceptionPage99 !
(99! "
)99" #
;99# $
}:: 
app<< 
.<< 
UseHttpsRedirection<< 
(<< 
)<< 
;<< 
app>> 
.>> 

UseRouting>> 
(>> 
)>> 
;>> 
app@@ 
.@@ 
UseAuthorization@@ 
(@@ 
)@@ 
;@@ 
appBB 
.BB 
UseEndpointsBB 
(BB 
	endpointsBB 
=>BB  
{CC 
	endpointsDD 
.DD 
MapControllersDD 
(DD 
)DD 
;DD 
}EE 
)EE 
;EE 
}FF 
}GG 
}HH 