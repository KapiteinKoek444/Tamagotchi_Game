‹K
pC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Inventory\Controllers\ActiveMqController.cs
	namespace 	
Tamago_Inventory
 
. 
Controllers &
{ 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
ActiveMQController  
:! "

Controller# -
{ 
private 	
IMongoCollection
 
< 
InventoryModel )
>) * 
_inventoryCollection+ ?
;? @
private 	
readonly
 
IActiveMqLog 
_activeMQLogShop  0
;0 1
private 	
readonly
 
IActiveMqLog 
_activeMQLog  ,
;, -
private 	$
RequestItemResponseModel
 "
response# +
=, -
new. 1$
RequestItemResponseModel2 J
(J K
)K L
;L M
private 	
bool
 
received 
= 
false 
;  
public 
ActiveMQController	 
( 
IMongoClient (
client) /
,/ 0
IActiveMqLog1 =
activeMQLog> I
)I J
{ 
var 
database 
= 
client 
. 
GetDatabase $
($ %
$str% 9
)9 :
;: ; 
_inventoryCollection 
= 
database "
." #
GetCollection# 0
<0 1
InventoryModel1 ?
>? @
(@ A
$strA M
)M N
;N O
_activeMQLogShop!! 
=!! 
activeMQLog!! !
;!!! "
_activeMQLog"" 
="" 
activeMQLog"" 
;"" 
ListenToMessage$$ 
($$ 
)$$ 
;$$ 
}%% 
['' #
ExcludeFromCodeCoverage'' 
]'' 
private(( 	
async((
 
void(( 
ListenToMessage(( $
((($ %
)((% &
{)) 
_activeMQLogShop++ 
.++ 
ConnectListener++ #
(++# $
$str++$ >
)++> ?
;++? @
var,, 
ShopListener,, 
=,, 
_activeMQLogShop,, &
.,,& '
GetMessageConsumer,,' 9
(,,9 :
),,: ;
;,,; <
ShopListener-- 
.-- 
Listener-- 
+=-- 
new-- 
MessageListener--  /
(--/ 0
UponShopBuyMessage--0 B
)--B C
;--C D
_activeMQLog00 
.00 
ConnectListener00 
(00  
$str00  7
)007 8
;008 9
var11 
listener11 
=11 
_activeMQLog11 
.11 
GetMessageConsumer11 1
(111 2
)112 3
;113 4
listener22 
.22 
Listener22 
+=22 
new22 
MessageListener22 +
(22+ ,
UponShopGetMessage22, >
)22> ?
;22? @
}44 
[66 
HttpGet66 

(66
 
$str66 
)66 
]66 
[77 
Route77 
(77 	
$str77	 
)77 
]77 
public88 
async88	 
Task88 
<88 
List88 
<88 
	FoodModel88 "
>88" #
>88# $
GetFood88% ,
(88, -
[88- .
	FromRoute88. 7
]887 8
Guid889 =
id88> @
)88@ A
{99 
var:: 
filter:: 
=:: 
Builders:: 
<:: 
InventoryModel:: '
>::' (
.::( )
Filter::) /
.::/ 0
Eq::0 2
(::2 3
$str::3 ;
,::; <
id::= ?
)::? @
;::@ A
var;; 
data;; 
=;;  
_inventoryCollection;; "
.;;" #
Find;;# '
(;;' (
filter;;( .
);;. /
.;;/ 0
First;;0 5
(;;5 6
);;6 7
;;;7 8
await<< 
WaitForFood<<	 
(<< 
data<< 
)<< 
;<< 
return== 	
response==
 
.== 
items== 
;== 
}>> 
[@@ #
ExcludeFromCodeCoverage@@ 
]@@ 
privateAA 	
asyncAA
 
TaskAA 
<AA 
stringAA 
>AA 
WaitForFoodAA (
(AA( )
InventoryModelAA) 7
dataAA8 <
)AA< =
{BB 
RequestItemModelCC 
modelCC 
=CC 
newCC 
RequestItemModelCC  0
(CC0 1
)CC1 2
;CC2 3
modelDD 
.DD 	
ItemsDD	 
=DD 
dataDD 
.DD 
itemIdDD 
;DD 
modelEE 
.EE 	
userIdEE	 
=EE 
dataEE 
.EE 
userIdEE 
;EE 
_activeMQLogFF 
.FF 
ConnectSenderFF 
(FF 
$strFF 2
)FF2 3
;FF3 4
varGG 
producerGG 
=GG 
_activeMQLogGG 
.GG 
GetMessageProducerGG 1
(GG1 2
)GG2 3
;GG3 4
varHH 
messageHH 
=HH 
_activeMQLogHH 
.HH #
ConvertObjectToIMessageHH 5
<HH5 6
RequestItemModelHH6 F
>HHF G
(HHG H
modelHHH M
)HHM N
;HHN O
producerII 
.II 
SendII 
(II 
messageII 
)II 
;II 
whileKK 
(KK	 

receivedKK
 
==KK 
falseKK 
)KK 
{LL 
TaskMM 
.MM 	
DelayMM	 
(MM 
$numMM 
)MM 
;MM 
}NN 
returnPP 	
$strPP
 
;PP 
}QQ 
[SS #
ExcludeFromCodeCoverageSS 
]SS 
privateTT 	
asyncTT
 
voidTT 
UponShopGetMessageTT '
(TT' (
IMessageTT( 0
messageTT1 8
)TT8 9
{UU 
ITextMessageVV 
objectMessageVV 
=VV 
messageVV  '
asVV( *
ITextMessageVV+ 7
;VV7 8
responseWW 
=WW 
_activeMQLogWW 
.WW #
ConvertIMessageToObjectWW 2
<WW2 3$
RequestItemResponseModelWW3 K
>WWK L
(WWL M
objectMessageWWM Z
)WWZ [
;WW[ \
receivedXX 
=XX 
trueXX 
;XX 
}YY 
[[[ #
ExcludeFromCodeCoverage[[ 
][[ 
private\\ 	
async\\
 
void\\ 
UponShopBuyMessage\\ '
(\\' (
IMessage\\( 0
message\\1 8
)\\8 9
{]] 
_activeMQLogShop__ 
.__ 
ConnectSender__ !
(__! "
$str__" 9
)__9 :
;__: ;
var`` 
producer`` 
=`` 
_activeMQLogShop`` "
.``" #
GetMessageProducer``# 5
(``5 6
)``6 7
;``7 8
ITextMessagebb 
objectMessagebb 
=bb 
messagebb  '
asbb( *
ITextMessagebb+ 7
;bb7 8
varcc 
responsecc 
=cc 
_activeMQLogShopcc "
.cc" ##
ConvertIMessageToObjectcc# :
<cc: ;
	ItemModelcc; D
>ccD E
(ccE F
objectMessageccF S
)ccS T
;ccT U
varee 
filteree 
=ee 
Buildersee 
<ee 
InventoryModelee '
>ee' (
.ee( )
Filteree) /
.ee/ 0
Eqee0 2
(ee2 3
$stree3 ;
,ee; <
responseee= E
.eeE F
userIdeeF L
)eeL M
;eeM N
vargg 
datagg 
=gg  
_inventoryCollectiongg "
.gg" #
Findgg# '
(gg' (
filtergg( .
)gg. /
.gg/ 0
Firstgg0 5
(gg5 6
)gg6 7
;gg7 8
datahh 
.hh 
itemIdhh 
.hh 
Addhh 
(hh 
responsehh 
.hh 
itemIdhh "
)hh" #
;hh# $
varjj 
updatejj 
=jj 
Buildersjj 
<jj 
InventoryModeljj '
>jj' (
.jj( )
Updatejj) /
.jj/ 0
Setjj0 3
(jj3 4
$strjj4 <
,jj< =
datajj> B
.jjB C
itemIdjjC I
)jjI J
;jjJ K 
_inventoryCollectionll 
.ll 
	UpdateOnell !
(ll! "
filterll" (
,ll( )
updatell* 0
)ll0 1
;ll1 2
producernn 
.nn 
Sendnn 
(nn 
objectMessagenn 
)nn 
;nn  
}oo 
[qq 
HttpGetqq 

]qq
 
publicrr 
asyncrr	 
Taskrr 
<rr 
stringrr 
>rr 
Getrr 
(rr  
)rr  !
{ss 
returntt 	
$strtt
 &
;tt& '
}uu 
}vv 
}ww ù,
lC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Inventory\Controllers\RestController.cs
	namespace		 	
Tamago_Inventory		
 
.		 
Controllers		 &
{

 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
RestController 
: 

Controller )
{ 
private 	
IMongoCollection
 
< 
InventoryModel )
>) * 
_inventoryCollection+ ?
;? @
public 
RestController	 
( 
IMongoClient $
client% +
)+ ,
{ 
var 
database 
= 
client 
. 
GetDatabase $
($ %
$str% 9
)9 :
;: ; 
_inventoryCollection 
= 
database "
." #
GetCollection# 0
<0 1
InventoryModel1 ?
>? @
(@ A
$strA M
)M N
;N O
} 
[ 
HttpGet 

]
 
public 
IEnumerable	 
< 
InventoryModel #
># $
Get% (
(( )
)) *
{ 
var 
data 
=  
_inventoryCollection "
." #
Find# '
(' (
Builders( 0
<0 1
InventoryModel1 ?
>? @
.@ A
FilterA G
.G H
EmptyH M
)M N
.N O
ToListO U
(U V
)V W
;W X
return 	
data
 
; 
} 
[ 
HttpGet 

(
 
$str 
) 
] 
public 
InventoryModel	 
Get 
( 
[ 
	FromRoute &
]& '
Guid( ,
id- /
)/ 0
{   
var!! 
filter!! 
=!! 
Builders!! 
<!! 
InventoryModel!! '
>!!' (
.!!( )
Filter!!) /
.!!/ 0
Eq!!0 2
(!!2 3
$str!!3 ;
,!!; <
id!!= ?
)!!? @
;!!@ A
var"" 
data"" 
=""  
_inventoryCollection"" "
.""" #
Find""# '
(""' (
filter""( .
)"". /
.""/ 0
FirstOrDefault""0 >
(""> ?
)""? @
;""@ A
return## 	
data##
 
;## 
}$$ 
[&& 

HttpDelete&& 
(&& 
$str&& 
)&& 
]&& 
['' 
Route'' 
('' 	
$str''	 
)'' 
]'' 
public(( 
InventoryModel((	 
Remove(( 
((( 
[((  
	FromRoute((  )
](() *
Guid((+ /
id((0 2
)((2 3
{)) 
var** 
filter** 
=** 
Builders** 
<** 
InventoryModel** '
>**' (
.**( )
Filter**) /
.**/ 0
Eq**0 2
(**2 3
$str**3 ;
,**; <
id**= ?
)**? @
;**@ A
var++ 
data++ 
=++  
_inventoryCollection++ "
.++" #
FindOneAndDelete++# 3
(++3 4
filter++4 :
)++: ;
;++; <
return,, 	
data,,
 
;,, 
}-- 
[// 
HttpPost// 
]// 
[00 
Route00 
(00 	
$str00	 
)00 
]00 
public11 
IActionResult11	 
Post11 
(11 
[11 
FromBody11 %
]11% &
InventoryModel11' 5
inv116 9
)119 :
{22  
_inventoryCollection33 
.33 
	InsertOne33 !
(33! "
inv33" %
)33% &
;33& '
return44 	

StatusCode44
 
(44 
StatusCodes44  
.44  !
Status201Created44! 1
,441 2
inv443 6
)446 7
;447 8
}55 
[77 
HttpPost77 
(77 
$str77 
)77 
]77 
[88 
Route88 
(88 	
$str88	 
)88 
]88 
public99 
InventoryModel99	 
Post99 
(99 
[99 
	FromRoute99 '
]99' (
Guid99) -
id99. 0
)990 1
{:: 
InventoryModel;; 
inv;; 
=;; 
new;; 
InventoryModel;; *
(;;* +
);;+ ,
;;;, -
inv<< 
.<< 
id<< 	
=<<
 
Guid<< 
.<< 
NewGuid<< 
(<< 
)<< 
;<< 
inv== 
.== 
userId== 
=== 
id== 
;== 
inv>> 
.>> 
itemId>> 
=>> 
new>> 
List>> 
<>> 
Guid>> 
>>> 
(>> 
)>>  
;>>  ! 
_inventoryCollection?? 
.?? 
	InsertOne?? !
(??! "
inv??" %
)??% &
;??& '
return@@ 	
inv@@
 
;@@ 
}AA 
}BB 
}CC ˙

YC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Inventory\Program.cs
	namespace 	
Tamago_Inventory
 
{ 
[ #
ExcludeFromCodeCoverage 
] 
public 
class 
Program 
{ 
public 
static	 
void 
Main 
( 
string  
[  !
]! "
args# '
)' (
{ 
CreateHostBuilder 
( 
args 
) 
. 
Build  
(  !
)! "
." #
Run# &
(& '
)' (
;( )
} 
public 
static	 
IHostBuilder 
CreateHostBuilder .
(. /
string/ 5
[5 6
]6 7
args8 <
)< =
=>> @
Host 
.  
CreateDefaultBuilder 
( 
args !
)! "
. $
ConfigureWebHostDefaults 
( 

webBuilder (
=>) +
{ 

webBuilder 
. 

UseStartup 
< 
Startup "
>" #
(# $
)$ %
;% &
} 
) 
; 
} 
} ®
YC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Inventory\Startup.cs
	namespace 	
Tamago_Inventory
 
{ 
[ #
ExcludeFromCodeCoverage 
] 
public 
class 
Startup 
{ 
public 
Startup	 
( 
IConfiguration 
configuration  -
)- .
{ 
Configuration 
= 
configuration  
;  !
} 
public 
IConfiguration	 
Configuration %
{& '
get( +
;+ ,
}- .
public 
void	 
ConfigureServices 
(  
IServiceCollection  2
services3 ;
); <
{ 
services 
. 
AddSingleton 
< 
IMongoClient %
,% &
MongoClient' 2
>2 3
(3 4
s4 5
=>6 8
{   
var!! 
uri!! 
=!! 
s!! 
.!! 
GetRequiredService!! "
<!!" #
IConfiguration!!# 1
>!!1 2
(!!2 3
)!!3 4
[!!4 5
$str!!5 ?
]!!? @
;!!@ A
return"" 

new"" 
MongoClient"" 
("" 
uri"" 
)"" 
;""  
}## 
)## 
;## 
services%% 
.%% 
AddSingleton%% 
<%% 
IActiveMqLog%% %
,%%% &
ActiveMQLog%%' 2
>%%2 3
(%%3 4
s%%4 5
=>%%6 8
{&& 
var'' 
uri'' 
='' 
s'' 
.'' 
GetRequiredService'' "
<''" #
IConfiguration''# 1
>''1 2
(''2 3
)''3 4
[''4 5
$str''5 <
]''< =
;''= >
var(( 
username(( 
=(( 
s(( 
.(( 
GetRequiredService(( '
<((' (
IConfiguration((( 6
>((6 7
(((7 8
)((8 9
[((9 :
$str((: F
]((F G
;((G H
var)) 
password)) 
=)) 
s)) 
.)) 
GetRequiredService)) '
<))' (
IConfiguration))( 6
>))6 7
())7 8
)))8 9
[))9 :
$str)): F
]))F G
;))G H
ActiveMQLog,, 
result,, 
=,, 
new,, 
ActiveMQLog,, (
(,,( )
uri,,) ,
,,,, -
username,,. 6
,,,6 7
password,,8 @
),,@ A
;,,A B
return-- 

result-- 
;-- 
}.. 
).. 
;.. 
services00 
.00 
AddControllers00 
(00 
)00 
;00 
}11 
public44 
void44	 
	Configure44 
(44 
IApplicationBuilder44 +
app44, /
,44/ 0
IWebHostEnvironment441 D
env44E H
)44H I
{55 
if66 
(66 
env66 

.66
 
IsDevelopment66 
(66 
)66 
)66 
{77 
app88 
.88 %
UseDeveloperExceptionPage88 !
(88! "
)88" #
;88# $
}99 
app;; 
.;; 

UseRouting;; 
(;; 
);; 
;;; 
app== 
.== 
UseAuthorization== 
(== 
)== 
;== 
app?? 
.?? 
UseEndpoints?? 
(?? 
	endpoints?? 
=>??  
{@@ 
	endpointsAA 
.AA 
MapControllersAA 
(AA 
)AA 
;AA 
}BB 
)BB 
;BB 
}CC 
}DD 
}EE 