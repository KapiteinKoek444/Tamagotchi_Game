¬.
kC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Bank\Controllers\ActiveMqController.cs
	namespace 	
Tamago_Bank
 
. 
Controllers !
{ 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
ActiveMQController  
:! "

Controller# -
{ 
private 	
IMongoCollection
 
< 
WalletModel &
>& '
_bankcollection( 7
;7 8
private 	
readonly
 
IActiveMqLog 
_activeMQLog  ,
;, -
public 
ActiveMQController	 
( 
IMongoClient (
client) /
,/ 0
IActiveMqLog1 =
activeMQLog> I
)I J
{ 
var 
database 
= 
client 
. 
GetDatabase $
($ %
$str% 4
)4 5
;5 6
_bankcollection 
= 
database 
. 
GetCollection +
<+ ,
WalletModel, 7
>7 8
(8 9
$str9 B
)B C
;C D
_activeMQLog 
= 
activeMQLog 
; 
ListenToMessage 
( 
) 
; 
} 
[ #
ExcludeFromCodeCoverage 
] 
private 	
async
 
void 
ListenToMessage $
($ %
)% &
{   
_activeMQLog!! 
.!! 
ConnectListener!! 
(!!  
$str!!  4
)!!4 5
;!!5 6
var"" 
listener"" 
="" 
_activeMQLog"" 
."" 
GetMessageConsumer"" 1
(""1 2
)""2 3
;""3 4
listener$$ 
.$$ 
Listener$$ 
+=$$ 
new$$ 
MessageListener$$ +
($$+ ,
UponMessage$$, 7
)$$7 8
;$$8 9
}%% 
['' #
ExcludeFromCodeCoverage'' 
]'' 
private(( 	
async((
 
void(( 
UponMessage((  
(((  !
IMessage((! )
received((* 2
)((2 3
{)) 
_activeMQLog** 
.** 
ConnectSender** 
(** 
$str** :
)**: ;
;**; <
var++ 
producer++ 
=++ 
_activeMQLog++ 
.++ 
GetMessageProducer++ 1
(++1 2
)++2 3
;++3 4
ITextMessage,, 
objectMessage,, 
=,, 
received,,  (
as,,) +
ITextMessage,,, 8
;,,8 9
	ItemModel-- 
m-- 
=-- 
_activeMQLog-- 
.-- #
ConvertIMessageToObject-- 5
<--5 6
	ItemModel--6 ?
>--? @
(--@ A
objectMessage--A N
)--N O
;--O P
Guid.. 
id.. 

=.. 
m.. 
... 
userId.. 
;.. 
var// 
filter// 
=// 
Builders// 
<// 
WalletModel// $
>//$ %
.//% &
Filter//& ,
.//, -
Eq//- /
(/// 0
$str//0 8
,//8 9
id//: <
)//< =
;//= >
var00 
allData00 
=00 
_bankcollection00  
.00  !
Find00! %
(00% &
Builders00& .
<00. /
WalletModel00/ :
>00: ;
.00; <
Filter00< B
.00B C
Empty00C H
)00H I
.00I J
ToList00J P
(00P Q
)00Q R
;00R S
var11 
data11 
=11 
allData11 
.11 
Where11 
(11 
x11 
=>11  
x11! "
.11" #
userId11# )
==11* ,
id11- /
)11/ 0
.110 1
FirstOrDefault111 ?
(11? @
)11@ A
;11A B
if33 
(33 
data33 
.33 
balance33 
<33 
m33 
.33 
price33 
)33 
m44 
.44 
confirmation44 
=44 
false44 
;44 
else55 
m66 
.66 
confirmation66 
=66 
true66 
;66 
var88 
update88 
=88 
Builders88 
<88 
WalletModel88 $
>88$ %
.88% &
Update88& ,
.88, -
Set88- 0
(880 1
$str881 :
,88: ;
data88< @
.88@ A
balance88A H
-88I J
m88K L
.88L M
price88M R
)88R S
;88S T
_bankcollection99 
.99 
	UpdateOne99 
(99 
filter99 #
,99# $
update99% +
)99+ ,
;99, -
var;; 
res;; 

=;; 
_activeMQLog;; 
.;; #
ConvertObjectToIMessage;; 1
<;;1 2
	ItemModel;;2 ;
>;;; <
(;;< =
m;;= >
);;> ?
;;;? @
producer<< 
.<< 
Send<< 
(<< 
res<< 
)<< 
;<< 
}== 
[?? 
HttpGet?? 

]??
 
public@@ 
async@@	 
Task@@ 
<@@ 
string@@ 
>@@ 
Get@@ 
(@@  
)@@  !
{AA 
returnBB 	
$strBB
 &
;BB& '
}CC 
}DD 
}EE —+
gC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Bank\Controllers\RestController.cs
	namespace		 	
Tamago_Bank		
 
.		 
Controllers		 !
{

 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
RestController 
: 

Controller )
{ 
private 	
IMongoCollection
 
< 
WalletModel &
>& '
_walletCollection( 9
;9 :
public 
RestController	 
( 
IMongoClient $
client% +
)+ ,
{ 
var 
database 
= 
client 
. 
GetDatabase $
($ %
$str% 4
)4 5
;5 6
_walletCollection 
= 
database 
.  
GetCollection  -
<- .
WalletModel. 9
>9 :
(: ;
$str; D
)D E
;E F
} 
[ 
HttpGet 

]
 
public 
IEnumerable	 
< 
WalletModel  
>  !
Get" %
(% &
)& '
{ 
var 
data 
= 
_walletCollection 
.  
Find  $
($ %
Builders% -
<- .
WalletModel. 9
>9 :
.: ;
Filter; A
.A B
EmptyB G
)G H
.H I
ToListI O
(O P
)P Q
;Q R
return 	
data
 
; 
} 
[ 
HttpGet 

(
 
$str 
) 
] 
public 
WalletModel	 
Get 
( 
[ 
	FromRoute #
]# $
Guid% )
id* ,
), -
{   
var!! 
filter!! 
=!! 
Builders!! 
<!! 
WalletModel!! $
>!!$ %
.!!% &
Filter!!& ,
.!!, -
Eq!!- /
(!!/ 0
$str!!0 8
,!!8 9
id!!: <
)!!< =
;!!= >
var"" 
data"" 
="" 
_walletCollection"" 
.""  
Find""  $
(""$ %
filter""% +
)""+ ,
."", -
FirstOrDefault""- ;
(""; <
)""< =
;""= >
return## 	
data##
 
;## 
}$$ 
[&& 

HttpDelete&& 
(&& 
$str&& 
)&& 
]&& 
['' 
Route'' 
('' 	
$str''	 
)'' 
]'' 
public(( 
WalletModel((	 
Remove(( 
((( 
[(( 
	FromRoute(( &
]((& '
Guid((( ,
id((- /
)((/ 0
{)) 
var** 
filter** 
=** 
Builders** 
<** 
WalletModel** $
>**$ %
.**% &
Filter**& ,
.**, -
Eq**- /
(**/ 0
$str**0 8
,**8 9
id**: <
)**< =
;**= >
var++ 
data++ 
=++ 
_walletCollection++ 
.++  
FindOneAndDelete++  0
(++0 1
filter++1 7
)++7 8
;++8 9
return,, 	
data,,
 
;,, 
}-- 
[// 
HttpPost// 
]// 
[00 
Route00 
(00 	
$str00	 
)00 
]00 
public11 
IActionResult11	 
Post11 
(11 
[11 
FromBody11 %
]11% &
WalletModel11' 2
wallet113 9
)119 :
{22 
_walletCollection33 
.33 
	InsertOne33 
(33 
wallet33 %
)33% &
;33& '
return44 	

StatusCode44
 
(44 
StatusCodes44  
.44  !
Status201Created44! 1
,441 2
wallet443 9
)449 :
;44: ;
}55 
[77 
HttpPost77 
(77 
$str77 
)77 
]77 
[88 
Route88 
(88 	
$str88	 
)88 
]88 
public99 
WalletModel99	 
Post99 
(99 
[99 
	FromRoute99 $
]99$ %
Guid99& *
id99+ -
)99- .
{:: 
WalletModel;; 
wallet;; 
=;; 
new;; 
WalletModel;; '
(;;' (
);;( )
;;;) *
wallet<< 	
.<<	 

id<<
 
=<< 
Guid<< 
.<< 
NewGuid<< 
(<< 
)<< 
;<< 
wallet== 	
.==	 

balance==
 
=== 
$num== 
;== 
wallet>> 	
.>>	 

userId>>
 
=>> 
id>> 
;>> 
_walletCollection?? 
.?? 
	InsertOne?? 
(?? 
wallet?? %
)??% &
;??& '
return@@ 	
wallet@@
 
;@@ 
}AA 
}BB 
}CC ð

TC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Bank\Program.cs
	namespace 	
Tamago_Bank
 
{ 
[ #
ExcludeFromCodeCoverage 
] 
public 
class 
Program 
{ 
public 
static	 
void 
Main 
( 
string  
[  !
]! "
args# '
)' (
{ 
CreateHostBuilder 
( 
args 
) 
. 
Build  
(  !
)! "
." #
Run# &
(& '
)' (
;( )
} 
public 
static	 
IHostBuilder 
CreateHostBuilder .
(. /
string/ 5
[5 6
]6 7
args8 <
)< =
=>> @
Host 
.  
CreateDefaultBuilder 
( 
args !
)! "
. $
ConfigureWebHostDefaults 
( 

webBuilder (
=>) +
{ 

webBuilder 
. 

UseStartup 
< 
Startup "
>" #
(# $
)$ %
;% &
} 
) 
; 
} 
} ž
TC:\Users\Pouki\Documents\#Rep_C\#Fontys_S3\S3_Tamago_WebApi's\Tamago_Bank\Startup.cs
	namespace 	
Tamago_Bank
 
{ 
[ #
ExcludeFromCodeCoverage 
] 
public 
class 
Startup 
{ 
public 
Startup	 
( 
IConfiguration 
configuration  -
)- .
{ 
Configuration 
= 
configuration  
;  !
} 
public 
IConfiguration	 
Configuration %
{& '
get( +
;+ ,
}- .
public 
void	 
ConfigureServices 
(  
IServiceCollection  2
services3 ;
); <
{ 
services 
. 
AddSingleton 
< 
IMongoClient %
,% &
MongoClient' 2
>2 3
(3 4
s4 5
=>6 8
{   
var!! 
uri!! 
=!! 
s!! 
.!! 
GetRequiredService!! "
<!!" #
IConfiguration!!# 1
>!!1 2
(!!2 3
)!!3 4
[!!4 5
$str!!5 ?
]!!? @
;!!@ A
return"" 

new"" 
MongoClient"" 
("" 
uri"" 
)"" 
;""  
}## 
)## 
;## 
services%% 
.%% 
AddSingleton%% 
<%% 
IActiveMqLog%% %
,%%% &
ActiveMQLog%%' 2
>%%2 3
(%%3 4
s%%4 5
=>%%6 8
{&& 
var'' 
uri'' 
='' 
s'' 
.'' 
GetRequiredService'' "
<''" #
IConfiguration''# 1
>''1 2
(''2 3
)''3 4
[''4 5
$str''5 <
]''< =
;''= >
var(( 
username(( 
=(( 
s(( 
.(( 
GetRequiredService(( '
<((' (
IConfiguration((( 6
>((6 7
(((7 8
)((8 9
[((9 :
$str((: F
]((F G
;((G H
var)) 
password)) 
=)) 
s)) 
.)) 
GetRequiredService)) '
<))' (
IConfiguration))( 6
>))6 7
())7 8
)))8 9
[))9 :
$str)): F
]))F G
;))G H
ActiveMQLog,, 
result,, 
=,, 
new,, 
ActiveMQLog,, (
(,,( )
uri,,) ,
,,,, -
username,,. 6
,,,6 7
password,,8 @
),,@ A
;,,A B
return-- 

result-- 
;-- 
}.. 
).. 
;.. 
services00 
.00 
AddControllers00 
(00 
)00 
;00 
}11 
public44 
void44	 
	Configure44 
(44 
IApplicationBuilder44 +
app44, /
,44/ 0
IWebHostEnvironment441 D
env44E H
)44H I
{55 
if66 
(66 
env66 

.66
 
IsDevelopment66 
(66 
)66 
)66 
{77 
app88 
.88 %
UseDeveloperExceptionPage88 !
(88! "
)88" #
;88# $
}99 
app;; 
.;; 

UseRouting;; 
(;; 
);; 
;;; 
app== 
.== 
UseAuthorization== 
(== 
)== 
;== 
app?? 
.?? 
UseEndpoints?? 
(?? 
	endpoints?? 
=>??  
{@@ 
	endpointsAA 
.AA 
MapControllersAA 
(AA 
)AA 
;AA 
}BB 
)BB 
;BB 
}CC 
}DD 
}EE 